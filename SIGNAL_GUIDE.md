# 📖 دليل الإشارات الجديد - Trading Bot

## 🎯 نظرة عامة

تم تحديث البوت لاستخدام نظام إشارات **مبسط وذكي** يعتمد على ثلاثة حقول فقط:
- `signal`: نوع الإشارة
- `symbol`: رمز العملة
- `id`: معرف الإشارة

سيقوم البوت تلقائياً باستنباط جميع التفاصيل الأخرى من إعدادات المستخدم.

---

## 📊 أنواع الإشارات المدعومة

### 1️⃣ إشارات السبوت (Spot)

#### BUY - شراء
```json
{
    "signal": "buy",
    "symbol": "BTCUSDT",
    "id": "TV_001"
}
```
- **الوصف**: شراء عملة في السوق الفوري (Spot)
- **نوع السوق**: Spot
- **الإجراء**: شراء

#### SELL - بيع
```json
{
    "signal": "sell",
    "symbol": "BTCUSDT",
    "id": "TV_002"
}
```
- **الوصف**: بيع عملة في السوق الفوري (Spot)
- **نوع السوق**: Spot
- **الإجراء**: بيع

---

### 2️⃣ إشارات الفيوتشر - Long (شراء)

#### LONG - فتح صفقة شراء
```json
{
    "signal": "long",
    "symbol": "BTCUSDT",
    "id": "TV_L01"
}
```
- **الوصف**: فتح صفقة شراء (Long) في سوق الفيوتشر
- **نوع السوق**: Futures
- **الإجراء**: شراء مع رافعة مالية

#### CLOSE_LONG - إغلاق صفقة الشراء
```json
{
    "signal": "close_long",
    "symbol": "BTCUSDT",
    "id": "TV_C01"
}
```
- **الوصف**: إغلاق صفقة شراء (Long) مفتوحة
- **نوع السوق**: Futures
- **الإجراء**: إغلاق صفقة الشراء

---

### 3️⃣ إشارات الفيوتشر - Short (بيع)

#### SHORT - فتح صفقة بيع
```json
{
    "signal": "short",
    "symbol": "ETHUSDT",
    "id": "TV_S01"
}
```
- **الوصف**: فتح صفقة بيع (Short) في سوق الفيوتشر
- **نوع السوق**: Futures
- **الإجراء**: بيع مع رافعة مالية

#### CLOSE_SHORT - إغلاق صفقة البيع
```json
{
    "signal": "close_short",
    "symbol": "ETHUSDT",
    "id": "TV_C02"
}
```
- **الوصف**: إغلاق صفقة بيع (Short) مفتوحة
- **نوع السوق**: Futures
- **الإجراء**: إغلاق صفقة البيع

---

## ⚙️ كيف يعمل النظام؟

### 1. استقبال الإشارة
عندما يستقبل البوت إشارة بالتنسيق الجديد، يقوم بالخطوات التالية:

```
📥 الإشارة الواردة
    ↓
✅ التحقق من صحة البيانات (signal, symbol, id)
    ↓
🔄 تحويل الإشارة إلى التنسيق الداخلي
    ↓
📊 إضافة إعدادات المستخدم (trade_amount, leverage)
    ↓
💰 جلب السعر الحالي من Bybit API
    ↓
⚡ تنفيذ الصفقة
```

### 2. الإعدادات التلقائية

يستنبط البوت التفاصيل التالية من إعدادات المستخدم:

| الإعداد | المصدر | القيمة الافتراضية |
|---------|--------|-------------------|
| **مبلغ التداول** | `trade_amount` | 100 USDT |
| **الرافعة المالية** | `leverage` | 10x |
| **المنصة** | `exchange` | Bybit |
| **نوع الحساب** | `account_type` | Demo |
| **السعر الحالي** | Bybit API | يُجلب تلقائياً |

### 3. تحديد نوع السوق

يحدد البوت نوع السوق **تلقائياً** بناءً على نوع الإشارة:

- `buy`, `sell` → **Spot**
- `long`, `close_long` → **Futures** (Long)
- `short`, `close_short` → **Futures** (Short)

---

## 🌐 إرسال الإشارات عبر TradingView

### Webhook URL للإشارات الشخصية

```
https://your-domain.com/personal/{user_id}/webhook
```

**مثال**: إذا كان معرف المستخدم `123456789`
```
https://your-domain.com/personal/123456789/webhook
```

### إعداد Alert في TradingView

1. افتح الشارت في TradingView
2. أنشئ Alert جديد
3. اختر **Webhook URL**
4. ضع رابط الـ Webhook الخاص بك
5. في حقل **Message**، ضع الإشارة بصيغة JSON:

#### مثال - شراء BTC
```json
{
    "signal": "buy",
    "symbol": "BTCUSDT",
    "id": "TV_BTC_001"
}
```

#### مثال - فتح Long على ETH
```json
{
    "signal": "long",
    "symbol": "ETHUSDT",
    "id": "TV_ETH_L01"
}
```

#### مثال - إغلاق Short على SOL
```json
{
    "signal": "close_short",
    "symbol": "SOLUSDT",
    "id": "TV_SOL_C01"
}
```

---

## 🔄 أمثلة عملية

### سيناريو 1: تداول Spot بسيط

**الإشارة الواردة:**
```json
{
    "signal": "buy",
    "symbol": "BTCUSDT",
    "id": "TV_001"
}
```

**ما يحدث:**
1. ✅ البوت يتحقق من صحة الإشارة
2. 🔄 يحول الإشارة إلى:
   - `action`: buy
   - `market_type`: spot
   - `amount`: 100 (من إعدادات المستخدم)
3. 💲 يجلب السعر الحالي لـ BTC
4. 🛒 ينفذ شراء بقيمة 100 USDT من BTC

### سيناريو 2: فتح وإغلاق Long في Futures

**الإشارة 1 - فتح Long:**
```json
{
    "signal": "long",
    "symbol": "ETHUSDT",
    "id": "TV_L01"
}
```

**ما يحدث:**
1. ✅ التحقق من الإشارة
2. 🔄 التحويل:
   - `action`: buy
   - `market_type`: futures
   - `amount`: 100
   - `leverage`: 10x
3. 💲 جلب سعر ETH
4. 📈 فتح صفقة Long بحجم 1000 USDT (100 × 10)

**الإشارة 2 - إغلاق Long:**
```json
{
    "signal": "close_long",
    "symbol": "ETHUSDT",
    "id": "TV_C01"
}
```

**ما يحدث:**
1. ✅ التحقق من الإشارة
2. 🔍 البحث عن صفقات Long مفتوحة على ETHUSDT
3. 💲 جلب السعر الحالي
4. ✅ إغلاق الصفقة وحساب الربح/الخسارة

### سيناريو 3: تداول Short

**الإشارة 1 - فتح Short:**
```json
{
    "signal": "short",
    "symbol": "SOLUSDT",
    "id": "TV_S01"
}
```

**الإشارة 2 - إغلاق Short:**
```json
{
    "signal": "close_short",
    "symbol": "SOLUSDT",
    "id": "TV_C02"
}
```

---

## 🔐 الأمان والتحقق

### التحقق من صحة الإشارة

يتحقق البوت من:
1. ✅ وجود جميع الحقول المطلوبة (`signal`, `symbol`)
2. ✅ نوع الإشارة ضمن الأنواع المدعومة
3. ✅ صحة رمز العملة (على الأقل 6 أحرف)
4. ✅ وجود المستخدم وتفعيله
5. ✅ توفر الرصيد الكافي

### رسائل الخطأ

إذا كانت الإشارة غير صحيحة، ستتلقى:
- ❌ رسالة خطأ توضيحية
- 📋 تفاصيل المشكلة
- 💡 اقتراحات للحل

---

## 📱 إشعارات التلجرام

عند استقبال إشارة، ستتلقى إشعار في التلجرام يحتوي على:

### إشعار فتح صفقة
```
📈 تم فتح صفقة تجريبية

👤 المستخدم: 123456789
📊 الرمز: BTCUSDT
🔄 النوع: BUY
💰 المبلغ: 100.0
💲 سعر الدخول: 45000.50
🏪 السوق: SPOT
🆔 رقم الصفقة: BTCUSDT_1234567890

💰 الرصيد: 9900.00
```

### إشعار إغلاق صفقة
```
✅ تم إغلاق صفقة

👤 المستخدم: 123456789
📊 الرمز: BTCUSDT
🔄 النوع: BUY
💰 الربح/الخسارة: +50.25
💲 سعر الدخول: 45000.50
💲 سعر الإغلاق: 45500.00
🆔 رقم الصفقة: BTCUSDT_1234567890

💰 الرصيد: 9950.25
```

---

## 🛠️ استكشاف الأخطاء

### المشكلة: "إشارة غير صحيحة"

**الأسباب المحتملة:**
- ❌ حقل `signal` أو `symbol` مفقود
- ❌ نوع إشارة غير مدعوم
- ❌ رمز عملة غير صحيح

**الحل:**
تأكد من استخدام التنسيق الصحيح:
```json
{
    "signal": "buy",
    "symbol": "BTCUSDT",
    "id": "TV_001"
}
```

### المشكلة: "المستخدم غير موجود"

**الحل:**
- تأكد من بدء البوت بالأمر `/start` أولاً
- تحقق من معرف المستخدم في رابط الـ Webhook

### المشكلة: "فشل جلب السعر"

**الأسباب:**
- ❌ رمز العملة غير موجود على Bybit
- ❌ مشكلة في الاتصال بـ API

**الحل:**
- تحقق من صحة رمز العملة
- استخدم الأزواج المتاحة على Bybit

---

## 📚 ملخص سريع

### الإشارات المدعومة

| الإشارة | النوع | السوق | الوصف |
|---------|-------|--------|-------|
| `buy` | شراء | Spot | شراء في السوق الفوري |
| `sell` | بيع | Spot | بيع في السوق الفوري |
| `long` | شراء | Futures | فتح صفقة شراء |
| `close_long` | إغلاق | Futures | إغلاق صفقة شراء |
| `short` | بيع | Futures | فتح صفقة بيع |
| `close_short` | إغلاق | Futures | إغلاق صفقة بيع |

### الحقول المطلوبة

- ✅ **signal**: نوع الإشارة (إجباري)
- ✅ **symbol**: رمز العملة (إجباري)
- ⚪ **id**: معرف الإشارة (اختياري)

### الحقول التلقائية

- 💰 **amount**: مبلغ التداول (من الإعدادات)
- ⚡ **leverage**: الرافعة المالية (من الإعدادات)
- 💲 **price**: السعر الحالي (يُجلب تلقائياً)
- 🏪 **market_type**: نوع السوق (يُحدد تلقائياً)

---

## 🎓 نصائح للاستخدام الأمثل

### 1. استخدم معرفات فريدة
```json
{
    "signal": "buy",
    "symbol": "BTCUSDT",
    "id": "TV_BTC_BUY_20231015_001"
}
```

### 2. اتبع نمط تسمية ثابت
- للشراء: `TV_L01`, `TV_L02`, ...
- للبيع: `TV_S01`, `TV_S02`, ...
- للإغلاق: `TV_C01`, `TV_C02`, ...

### 3. اختبر بحساب تجريبي أولاً
قبل استخدام الحساب الحقيقي، تأكد من:
- ✅ عمل جميع الإشارات بشكل صحيح
- ✅ استلام الإشعارات
- ✅ دقة الحسابات

### 4. راقب السجلات
تابع ملف `trading_bot.log` لمراقبة:
- 📥 الإشارات المستلمة
- 🔄 عمليات التحويل
- ⚡ تنفيذ الصفقات
- ❌ الأخطاء إن وجدت

---

## 🚀 الميزات الإضافية

### دعم المطورين
- 📡 توزيع الإشارات للمتابعين تلقائياً
- 📊 تتبع أداء الإشارات
- 👥 إدارة المتابعين

### الحسابات الحقيقية
- 🔴 التنفيذ المباشر على Bybit
- 💰 إدارة الرصيد الحقيقي
- 📈 صفقات حقيقية بالرافعة المالية

### الأدوات التلقائية
- 🎯 Take Profit تلقائي
- 🛑 Stop Loss تلقائي
- 📊 إغلاق جزئي ذكي

---

## 📞 الدعم

إذا واجهت أي مشكلة أو لديك استفسار:
1. تحقق من ملف السجل `trading_bot.log`
2. راجع هذا الدليل
3. تواصل مع الدعم عبر التلجرام

---

## 🎉 ملاحظات ختامية

النظام الجديد مصمم ليكون:
- ✅ **بسيط**: ثلاثة حقول فقط
- ✅ **ذكي**: يستنبط التفاصيل تلقائياً
- ✅ **آمن**: يتحقق من كل شيء
- ✅ **سريع**: يجلب الأسعار فوراً
- ✅ **موثوق**: يدعم الحسابات الحقيقية والتجريبية

استمتع بالتداول! 🚀📈

---

*آخر تحديث: أكتوبر 2025*

