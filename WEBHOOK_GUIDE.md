# ๐ก ุฏููู ุงุณุชุฎุฏุงู Webhook - ูุธุงู ุงูุฑูุงุจุท ุงูุดุฎุตูุฉ

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ุงูุจูุช ููุฏุนู ููุนูู ูู ุฑูุงุจุท Webhook:

### 1๏ธโฃ ุงูุฑุงุจุท ุงููุฏูู (Global Webhook)
ูุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ููุจูุช
```
https://botbybit-production.up.railway.app/webhook
```

### 2๏ธโฃ ุงูุฑูุงุจุท ุงูุดุฎุตูุฉ (Personal Webhooks) โจ ุฌุฏูุฏ
ููู ูุณุชุฎุฏู ุฑุงุจุท ุฎุงุต ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุชู ุงูุดุฎุตูุฉ
```
https://botbybit-production.up.railway.app/personal/<user_id>/webhook
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุฑุงุจุท ุงููุฏูู `/webhook`
- ูุนูู ููุง ูุงู ุณุงุจููุง
- ูุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ูู `config.py`
- ููุงุณุจ ูููุณุชุฎุฏู ุงูุฃุณุงุณู ุฃู ููุงุฎุชุจุงุฑ

**ูุซุงู:**
```bash
curl -X POST https://botbybit-production.up.railway.app/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "BTCUSDT",
    "action": "buy",
    "price": 50000
  }'
```

### ุงูุฑุงุจุท ุงูุดุฎุตู `/personal/<user_id>/webhook`
- ูุณุชุฎุฏู ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู ุงููุญุฏุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุฏุนู ุชุนุฏุฏ ุงููุณุชุฎุฏููู
- ูู ูุณุชุฎุฏู ูุฏูู:
  - ุฅุนุฏุงุฏุงุช ุฎุงุตุฉ (market_type, account_type, trade_amount, leverage)
  - ุตููุงุช ูุณุชููุฉ
  - ุฑุตูุฏ ูููุตู

**ูุซุงู ูููุณุชุฎุฏู 123456789:**
```bash
curl -X POST https://botbybit-production.up.railway.app/personal/123456789/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "ETHUSDT",
    "action": "buy",
    "price": 3000
  }'
```

---

## ๐ ุตูุบุฉ ุงูุฅุดุงุฑุงุช ุงููุฏุนููุฉ

### ุฅุดุงุฑุงุช ุงูุดุฑุงุก/ุงูุจูุน
```json
{
  "symbol": "BTCUSDT",
  "action": "buy",      // ุฃู "sell", "long", "short"
  "price": 50000        // ุงุฎุชูุงุฑู - ุฅุฐุง ูู ูุญุฏุฏุ ูุณุชุฎุฏู ุงูุณุนุฑ ุงูุญุงูู
}
```

### ุฅุดุงุฑุงุช ุงูุฅุบูุงู
```json
{
  "symbol": "BTCUSDT",
  "action": "close",    // ุฃู "exit", "stop"
  "price": 51000        // ุงุฎุชูุงุฑู
}
```

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ูุณุชุฎุฏู ูุญุชุงุฌ ุฅูู ุงูุณุฌู ุงูุชุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ุฌุฏูู users
user_id              INTEGER    -- ูุนุฑู ุงููุณุชุฎุฏู ูู Telegram
api_key              TEXT       -- ููุชุงุญ API ูู Bybit (ุงุฎุชูุงุฑู)
api_secret           TEXT       -- ุณุฑ API ูู Bybit (ุงุฎุชูุงุฑู)
balance              REAL       -- ุงูุฑุตูุฏ ุงูุญุงูู
is_active            BOOLEAN    -- ุญุงูุฉ ุงูุชูุนูู
notifications        BOOLEAN    -- ุชูุนูู ุงูุฅุดุนุงุฑุงุช

-- ุฌุฏูู user_settings
market_type          TEXT       -- "spot" ุฃู "futures"
trade_amount         REAL       -- ูุจูุบ ุงูุชุฏุงูู ุงูุงูุชุฑุงุถู
leverage             INTEGER    -- ุงูุฑุงูุนุฉ ุงููุงููุฉ (ูููููุชุดุฑ)
account_type         TEXT       -- "demo" ุฃู "real"
```

---

## ๐ Debug Logs

ุชู ุฅุถุงูุฉ ุฑุณุงุฆู debug ููุตูุฉ ูุชุชุจุน ูู ุนูููุฉ:

### ุนูุฏ ุงุณุชูุจุงู ุงูุฅุดุงุฑุฉ:
```
๐ [WEBHOOK ุดุฎุตู] ุงููุณุชุฎุฏู: 123456789
๐ [WEBHOOK ุดุฎุตู] ุงูุจูุงูุงุช ุงููุณุชููุฉ: {"symbol": "BTCUSDT", "action": "buy"}
โ [WEBHOOK ุดุฎุตู] ุงููุณุชุฎุฏู 123456789 ููุฌูุฏ ููุดุท
๐ [WEBHOOK ุดุฎุตู] ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู: market_type=futures, account_type=demo
```

### ุนูุฏ ูุนุงูุฌุฉ ุงูุตููุฉ:
```
๐ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ุจุฏุก ูุนุงูุฌุฉ ุฅุดุงุฑุฉ ุงููุณุชุฎุฏู 123456789
๐ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ุงูุฑูุฒ: BTCUSDT, ุงูุฅุฌุฑุงุก: buy, ุงูุณุนุฑ: 50000
โ๏ธ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ุงูุฅุนุฏุงุฏุงุช: market=futures, account=demo, amount=100.0, leverage=10
๐ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ูุชุญ ุตููุฉ buy ูููุณุชุฎุฏู 123456789
โ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ูุฌุญ ูุชุญ ุงูุตููุฉ ูููุณุชุฎุฏู 123456789
```

### ุนูุฏ ูุฌูุฏ ุฎุทุฃ:
```
โ๏ธ [WEBHOOK ุดุฎุตู] ุงููุณุชุฎุฏู 123456789 ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ๏ธ [WEBHOOK ุดุฎุตู] ุงููุณุชุฎุฏู 123456789 ุบูุฑ ูุดุท
โ [ูุนุงูุฌุฉ ุงูุฅุดุงุฑุฉ] ุจูุงูุงุช ุบูุฑ ููุชููุฉ ูููุณุชุฎุฏู 123456789
```

---

## ๐ ุงูุชุญูู ูู ุงูุฃูุงู

### ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู:
```python
user_data = user_manager.get_user(user_id)
if not user_data:
    return {"status": "error", "message": "User not found"}, 404
```

### ุงูุชุญูู ูู ุชูุนูู ุงููุณุชุฎุฏู:
```python
if not user_data.get('is_active', False):
    return {"status": "error", "message": "User is not active"}, 403
```

---

## ๐๏ธ ุฅุนุฏุงุฏ ุงููุณุชุฎุฏููู

### ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ุนุจุฑ Telegram:
1. ุงููุณุชุฎุฏู ูุฑุณู `/start` ููุจูุช
2. ุงูุจูุช ูููู ุจุฅูุดุงุก ุณุฌู ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุงุฆููุง
3. ูุชู ุชุฎุตูุต ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ูููุณุชุฎุฏู

### ุฅูุดุงุก ูุณุชุฎุฏู ูุฏูููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```python
from database import db_manager

# ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ
db_manager.create_user(
    user_id=123456789,
    api_key="YOUR_API_KEY",      # ุงุฎุชูุงุฑู
    api_secret="YOUR_API_SECRET"  # ุงุฎุชูุงุฑู
)

# ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู
db_manager.update_user_settings(
    user_id=123456789,
    settings={
        'market_type': 'futures',
        'trade_amount': 100.0,
        'leverage': 10,
        'account_type': 'demo',
        'partial_percents': [25, 50, 25],
        'tps_percents': [1.5, 3.0, 5.0],
        'notifications': True
    }
)
```

---

## ๐ ุฃูุซูุฉ ุงุณุชุฎุฏุงู ูู TradingView

### ุฅุนุฏุงุฏ Webhook ูู TradingView:

**ููุฑุงุจุท ุงููุฏูู:**
```
URL: https://botbybit-production.up.railway.app/webhook
Message:
{
  "symbol": "{{ticker}}",
  "action": "{{strategy.order.action}}",
  "price": {{close}}
}
```

**ููุฑุงุจุท ุงูุดุฎุตู:**
```
URL: https://botbybit-production.up.railway.app/personal/123456789/webhook
Message:
{
  "symbol": "{{ticker}}",
  "action": "{{strategy.order.action}}",
  "price": {{close}}
}
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

โ **ุฏุนู ุงููุณุชุฎุฏููู ุงููุชุนุฏุฏูู**: ูู ูุณุชุฎุฏู ูุฏูู ุฅุนุฏุงุฏุงุช ูุตููุงุช ูุณุชููุฉ  
โ **ุฑูุงุจุท ุดุฎุตูุฉ**: ุฑุงุจุท ูุฑูุฏ ููู ูุณุชุฎุฏู  
โ **Debug ูุชูุฏู**: ุฑุณุงุฆู ูุงุถุญุฉ ูุชุชุจุน ูู ุนูููุฉ  
โ **ุฅุดุนุงุฑุงุช Telegram**: ูุชููู ูู ูุณุชุฎุฏู ุฅุดุนุงุฑุงุช ุฎุงุตุฉ ุจู  
โ **ุงูุญูุงูุฉ**: ุงูุชุญูู ูู ูุฌูุฏ ูุชูุนูู ุงููุณุชุฎุฏู  
โ **ุฏุนู ุฌููุน ุฃููุงุน ุงูุฅุดุงุฑุงุช**: buy, sell, long, short, close, exit, stop  
โ **ูุนุงูุฌุฉ ูุชุฒุงููุฉ**: ูููู ุงุณุชูุจุงู ุนุฏุฉ ุฅุดุงุฑุงุช ูู ููุณ ุงูููุช  

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ูุนูู ุงูุฑุงุจุท ุงูุดุฎุตู:

1. **ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู:**
   ```python
   from database import db_manager
   user = db_manager.get_user(123456789)
   print(user)
   ```

2. **ุชุญูู ูู ุชูุนูู ุงููุณุชุฎุฏู:**
   ```python
   if user and user.get('is_active'):
       print("ุงููุณุชุฎุฏู ูุดุท โ")
   else:
       print("ุงููุณุชุฎุฏู ุบูุฑ ูุดุท โ")
   ```

3. **ุชุญูู ูู logs ุงูุณูุฑูุฑ:**
   - ุงุจุญุซ ุนู ุฑุณุงุฆู ุชุจุฏุฃ ุจู `[WEBHOOK ุดุฎุตู]`
   - ุชุญูู ูู ูุฌูุฏ ุฃุฎุทุงุก

4. **ุงุฎุชุจุฑ ุงูุฑุงุจุท:**
   ```bash
   curl -X POST https://botbybit-production.up.railway.app/personal/<user_id>/webhook \
     -H "Content-Type: application/json" \
     -d '{"symbol": "BTCUSDT", "action": "buy", "price": 50000}'
   ```

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน logs ุงูุณูุฑูุฑ
2. ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุฃูุฏ ูู ุตุญุฉ ุตูุบุฉ JSON ุงููุฑุณูุฉ
4. ุชุญูู ูู ุฃู user_manager ุชู ุชููุฆุชู ุจุดูู ุตุญูุญ

---

## ๐ ุฎูุงุตุฉ

ุงูุขู ูุฏูู ูุธุงู webhook ูุชูุฏู ูุฏุนู:
- โ ุงูุฑุงุจุท ุงููุฏูู ููุชูุงูู ูุน ุงูุฅุตุฏุงุฑ ุงูุณุงุจู
- โ ุฑูุงุจุท ุดุฎุตูุฉ ููู ูุณุชุฎุฏู
- โ ุฅุนุฏุงุฏุงุช ูููุตูุฉ ููู ูุณุชุฎุฏู
- โ debug ูุชูุฏู ูุณูููุฉ ุงูุชุชุจุน
- โ ุฃูุงู ูุญุณูู ูุน ุงูุชุญูู ูู ุงููุณุชุฎุฏููู

**ุงุณุชูุชุน ุจุงูุชุฏุงูู! ๐**

