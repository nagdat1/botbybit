# 🛡️ نظام إدارة المخاطر المتقدم

## 📋 نظرة عامة

نظام إدارة المخاطر المتقدم هو ميزة حماية شاملة تحمي حسابك من الخسائر الكبيرة عبر إيقاف البوت تلقائياً عند الوصول لحدود الخسارة المحددة.

## 🎯 المميزات الرئيسية

### 1. **حدود الخسارة المتعددة**
- **الحد المئوي**: نسبة مئوية من الرصيد الإجمالي
- **الحد بالمبلغ**: مبلغ ثابت بالـ USDT
- **الحد اليومي**: حد الخسارة اليومية
- **الحد الأسبوعي**: حد الخسارة الأسبوعية

### 2. **إيقاف تلقائي للبوت**
- إيقاف البوت فوراً عند الوصول لأي حد
- إشعار فوري للمستخدم عبر Telegram
- إعادة تفعيل يدوية من الإعدادات

### 3. **تتبع ذكي للخسائر**
- حساب الخسائر اليومية والأسبوعية والإجمالية
- إعادة تعيين تلقائية للحدود اليومية والأسبوعية
- ربط مباشر بالمحفظة الحقيقية والتجريبية

## 🚀 كيفية الاستخدام

### الوصول لنظام إدارة المخاطر

1. **افتح البوت** في Telegram
2. **اضغط على** "⚙️ الإعدادات"
3. **اضغط على** "🛡️ إدارة المخاطر"

### الإعدادات المتاحة

#### 🛡️ تفعيل/إلغاء إدارة المخاطر
- **مفعل**: النظام نشط ويحمي حسابك
- **معطل**: النظام غير نشط (غير مستحسن)

#### 📉 تعديل حد الخسارة المئوي
- **النطاق**: 1% - 50%
- **الافتراضي**: 10%
- **الوصف**: نسبة الخسارة من الرصيد الإجمالي

#### 💸 تعديل حد الخسارة بالمبلغ
- **النطاق**: أي مبلغ أكبر من 0
- **الافتراضي**: 1000 USDT
- **الوصف**: الحد الأقصى للخسارة بالمبلغ المطلق

#### 📅 تعديل الحد اليومي
- **النطاق**: أي مبلغ أكبر من 0
- **الافتراضي**: 500 USDT
- **الوصف**: الحد الأقصى للخسارة في اليوم الواحد

#### 📆 تعديل الحد الأسبوعي
- **النطاق**: أي مبلغ أكبر من 0
- **الافتراضي**: 2000 USDT
- **الوصف**: الحد الأقصى للخسارة في الأسبوع الواحد

#### ⏹️ إيقاف التداول عند الخسارة
- **مفعل**: البوت يتوقف عند الوصول لأي حد
- **معطل**: البوت يستمر حتى لو وصل للحدود

## 📊 إحصائيات المخاطر

### عرض الإحصائيات
اضغط على "📊 عرض إحصائيات المخاطر" لرؤية:

- **الخسارة اليومية**: المبلغ والنسبة من الحد
- **الخسارة الأسبوعية**: المبلغ والنسبة من الحد
- **إجمالي الخسارة**: المبلغ والنسبة المئوية
- **التوصيات**: نصائح بناءً على الوضع الحالي

### إعادة تعيين الإحصائيات
اضغط على "🔄 إعادة تعيين الإحصائيات" لمسح:
- الخسارة اليومية
- الخسارة الأسبوعية
- إجمالي الخسارة

## 🔄 آلية العمل

### 1. **فحص بعد كل صفقة**
```
صفقة مكتملة → فحص المخاطر → قرار الإيقاف
```

### 2. **حساب الخسائر**
- **للحساب التجريبي**: من الحسابات التجريبية الداخلية
- **للحساب الحقيقي**: من المنصات المرتبطة (Bybit, MEXC)

### 3. **إيقاف البوت**
عند الوصول لأي حد:
- إيقاف البوت فوراً (`is_active = False`)
- إرسال إشعار للمستخدم
- عرض سبب الإيقاف والإحصائيات

### 4. **إعادة التعيين التلقائي**
- **اليومي**: عند بداية يوم جديد
- **الأسبوعي**: عند بداية أسبوع جديد

## ⚠️ تحذيرات مهمة

### 🚨 **تحذير الأمان**
- **لا تعطل النظام** إلا إذا كنت متأكداً من استراتيجيتك
- **اضبط الحدود** بناءً على قدرتك المالية
- **راقب الإحصائيات** بانتظام

### 📊 **نصائح الإعداد**
- **الحد المئوي**: 5-15% من الرصيد الإجمالي
- **الحد اليومي**: 2-5% من الرصيد الإجمالي
- **الحد الأسبوعي**: 10-20% من الرصيد الإجمالي

### 🔄 **إعادة التشغيل**
بعد إيقاف البوت:
1. اذهب إلى "⚙️ الإعدادات"
2. اضغط على "▶️ تشغيل البوت"
3. تأكد من تعديل الإعدادات إذا لزم الأمر

## 🛠️ التكامل التقني

### الملفات المتأثرة
- `bybit_trading_bot.py`: واجهة المستخدم والدوال الرئيسية
- `signal_executor.py`: فحص المخاطر بعد كل صفقة
- `user_manager.py`: تخزين إعدادات وإحصائيات المخاطر

### الدوال الرئيسية
- `check_risk_management()`: فحص المخاطر الرئيسي
- `reset_daily_loss_if_needed()`: إعادة تعيين الخسارة اليومية
- `risk_management_menu()`: واجهة إدارة المخاطر

## 📈 مثال عملي

### السيناريو
- **الرصيد**: 10,000 USDT
- **الحد المئوي**: 10%
- **الحد اليومي**: 500 USDT
- **الحد الأسبوعي**: 2000 USDT

### النتائج
- **خسارة 100 USDT**: ✅ البوت يستمر
- **خسارة 500 USDT**: 🚨 البوت يتوقف (الحد اليومي)
- **خسارة 1000 USDT**: 🚨 البوت يتوقف (الحد المئوي)

## 🎯 الخلاصة

نظام إدارة المخاطر المتقدم يوفر:
- **حماية شاملة** من الخسائر الكبيرة
- **مرونة في الإعدادات** حسب احتياجاتك
- **تتبع دقيق** للخسائر والإحصائيات
- **إيقاف تلقائي** عند الحاجة
- **تكامل كامل** مع النظام الأساسي

استخدم هذا النظام بحكمة لحماية استثماراتك وتحسين أداء التداول! 🚀
