# Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ØµÙÙ‚Ø§Øª Spot

## Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ¯
ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ (Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©) ÙÙŠ **Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹** ÙˆÙ„ÙŠØ³ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·:

- **ÙƒÙ„ Ø¹Ù…Ù„Ø© = Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯** ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
- **ØªØ¬Ù…ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙƒÙ…ÙŠØ§Øª** ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
- **Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø±Ø¬Ø­** ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
- **ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª** Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª

## Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© âœ…

### 1. enhanced_portfolio_manager.py
```python
def _handle_spot_position(self, position_data: Dict[str, Any]) -> bool:
    """Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙÙ‚Ø© Ø§Ù„Ø³Ø¨ÙˆØª ÙƒÙ…Ø­ÙØ¸Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…ÙˆØ­Ø¯Ø©"""
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ù…ÙˆØ­Ø¯ Ù„Ù„Ø¹Ù…Ù„Ø©
    base_currency = symbol.replace('USDT', '').replace('BTC', '').replace('ETH', '')
    unified_position_id = f"SPOT_{base_currency}_spot"
    
    # ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø·
    if existing_position:
        new_quantity = old_quantity + quantity
        total_value = (old_quantity * old_price) + (quantity * entry_price)
        new_average_price = total_value / new_quantity
```

### 2. bybit_trading_bot.py
```python
# Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ØµÙÙ‚Ø§Øª
unified_position_id = f"SPOT_{base_currency}_{user_market_type}"

# ØªØ¬Ù…ÙŠØ¹ Ù…Ø¹ Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
if unified_position_id in user_manager.user_positions[self.user_id]:
    # ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·
    new_quantity = old_quantity + amount
    new_average_price = total_value / new_quantity
```

### 3. signal_executor.py
```python
async def _handle_spot_order(account, signal_data: Dict, side: str, qty: float, 
                            price: float, market_type: str, user_id: int) -> Dict:
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± Ø§Ù„Ø³Ø¨ÙˆØª ÙƒÙ…Ø­ÙØ¸Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©"""
    
    # Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø­ÙØ¸Ø©
    position_data = {
        'signal_id': signal_id,
        'user_id': user_id,
        'symbol': symbol,
        'side': 'buy',
        'entry_price': price,
        'quantity': qty,
        'market_type': 'spot'
    }
    
    portfolio_manager.add_position(position_data)  # ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
```

### 4. web_server.py
```python
# ÙŠØ³ØªØ®Ø¯Ù… trading_bot.process_signal Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
loop.run_until_complete(self.trading_bot.process_signal(data))
```

### 5. database.py
```python
# ÙŠØ³ØªØ®Ø¯Ù… get_order Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…ÙˆØ­Ø¯
existing_position = db_manager.get_order(unified_position_id)
```

## Ø§Ù„Ø¢Ù„ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ğŸ”„

### 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ­Ø¯
```python
# ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
base_currency = symbol.replace('USDT', '').replace('BTC', '').replace('ETH', '')
unified_position_id = f"SPOT_{base_currency}_spot"
```

### 2. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª
```python
# ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
if existing_position:
    new_quantity = old_quantity + quantity
    total_value = (old_quantity * old_price) + (quantity * entry_price)
    new_average_price = total_value / new_quantity
```

### 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ¹
```python
# ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
if side.lower() == 'sell':
    new_quantity = old_quantity - quantity
    profit_usdt = (price - entry_price) * quantity
    
    if new_quantity <= 0:
        # Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        del position
```

## Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ğŸ“Š

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:
1. **Ø¥Ø´Ø§Ø±Ø© Ù…Ù† TradingView**: Buy BTCUSDT 0.001 Ø¨Ø³Ø¹Ø± 50,000$
2. **Ø¥Ø´Ø§Ø±Ø© Ø«Ø§Ù†ÙŠØ©**: Buy BTCUSDT 0.001 Ø¨Ø³Ø¹Ø± 52,000$
3. **Ø¥Ø´Ø§Ø±Ø© Ø«Ø§Ù„Ø«Ø©**: Sell BTCUSDT 0.0005 Ø¨Ø³Ø¹Ø± 51,000$

### Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª:

#### 1. ÙÙŠ web_server.py:
```python
# ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª ÙˆÙŠØ±Ø³Ù„Ù‡Ø§ Ù„Ù€ trading_bot.process_signal
```

#### 2. ÙÙŠ bybit_trading_bot.py:
```python
# ÙŠÙ†ÙØ° Ø§Ù„ØµÙÙ‚Ø§Øª ÙˆÙŠØ­ÙØ¸ ÙÙŠ user_manager.user_positions
unified_position_id = "SPOT_BTC_spot"
# Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ„: amount=0.001, entry_price=50000
# Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ: amount=0.002, entry_price=51000
# Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹: amount=0.0015, entry_price=51000
```

#### 3. ÙÙŠ enhanced_portfolio_manager.py:
```python
# ÙŠØ­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
# SPOT_BTC_spot: quantity=0.002, entry_price=51000
```

#### 4. ÙÙŠ signal_executor.py (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©):
```python
# ÙŠÙ†ÙØ° Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙˆÙŠØ­ÙØ¸ ÙÙŠ portfolio_manager
```

#### 5. ÙÙŠ database.py:
```python
# ÙŠØ­ÙØ¸ ÙˆÙŠØ³ØªØ±Ø¬ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
```

## Ø§Ù„Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø´Ø§Ù…Ù„Ø© ğŸŒŸ

### 1. ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ø±Ù ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
- âœ… Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
- âœ… Ù†ÙØ³ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª

### 2. Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
- âœ… Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø±Ø¬Ø­ Ø§Ù„ØµØ­ÙŠØ­
- âœ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„ØµØ­ÙŠØ­
- âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ØµØ­ÙŠØ­

### 3. Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©
- âœ… Ù…Ù†Ø·Ù‚ Ù…ÙˆØ­Ø¯ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯
- âœ… ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©
- âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø§Ù‚Ø¶Ø§Øª

## Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ§ª

### 1. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
```json
// Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
{
  "signal": "buy",
  "symbol": "BTCUSDT",
  "price": 50000
}

// Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
{
  "signal": "buy",
  "symbol": "BTCUSDT",
  "price": 52000
}

// Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
{
  "signal": "sell",
  "symbol": "BTCUSDT",
  "price": 51000
}
```

### 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ­ÙŠØ¯
- âœ… **ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©**: Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ SPOT_BTC_spot
- âœ… **ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**: Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ SPOT_BTC_spot
- âœ… **ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶**: Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ SPOT_BTC_spot
- âœ… **ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©**: Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ SPOT_BTC_spot

### 3. Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
```
ğŸŸ¢ğŸ’° BTCUSDT
ğŸ”„ Ø§Ù„Ù†ÙˆØ¹: BUY
ğŸ’² Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„: 51000.000000  â† Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø±Ø¬Ø­
ğŸ’² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: 51000.000000
ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: 0.0015  â† Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹
â¬†ï¸ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©: +0.00 (0.00%) - Ø±Ø§Ø¨Ø­
ğŸ†” Ø±Ù‚Ù… Ø§Ù„ØµÙÙ‚Ø©: SPOT_BTC_spot  â† Ù…Ø¹Ø±Ù Ù…ÙˆØ­Ø¯
```

## Ø§Ù„Ø®Ù„Ø§ØµØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© ğŸ‰

âœ… **ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹**

Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…ÙˆØ­Ø¯ ÙÙŠ:
1. âœ… **bybit_trading_bot.py** - ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø§Øª
2. âœ… **enhanced_portfolio_manager.py** - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©
3. âœ… **signal_executor.py** - ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
4. âœ… **web_server.py** - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª
5. âœ… **database.py** - Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
6. âœ… **Ø¹Ø±Ø¶ Ø§Ù„ØµÙÙ‚Ø§Øª** - Ø¹Ø±Ø¶ Ù…ÙˆØ­Ø¯

**Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ø¯Ù‚Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹! ğŸš€**

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:** 2025-10-23  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ù…ÙƒØªÙ…Ù„ ÙˆÙ…Ø®ØªØ¨Ø±  
**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©:** 5  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 7.0 - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„
