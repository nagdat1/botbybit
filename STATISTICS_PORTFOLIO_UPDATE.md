# ๐ ุชุญุฏูุซุงุช ูุธุงู ุงูุฅุญุตุงุฆูุงุช ูุงููุญูุธุฉ ุงููุชูุฏู

## โ ุงูุชุญุฏูุซุงุช ุงูููุชููุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช - ุชุทูุฑ ุงููุญูุธุฉ ุงููููู
**ุงูููู:** `users/database.py`

#### โจ ุงูุฅุถุงูุงุช:
- **ุฌุฏูู ุฌุฏูุฏ:** `portfolio_snapshots` ูุญูุธ ููุทุงุช ููููุฉ ูููุญูุธุฉ
  - `user_id`: ูุนุฑู ุงููุณุชุฎุฏู
  - `account_type`: ููุน ุงูุญุณุงุจ (demo/real)
  - `snapshot_date`: ุชุงุฑูุฎ ุงูููุทุฉ
  - `balance`: ุงูุฑุตูุฏ
  - `total_pnl`: ุฅุฌูุงูู ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ
  - `open_positions_count`: ุนุฏุฏ ุงูุตููุงุช ุงูููุชูุญุฉ
  - `closed_trades_count`: ุนุฏุฏ ุงูุตููุงุช ุงููุบููุฉ
  - `winning_trades`: ุนุฏุฏ ุงูุตููุงุช ุงูุฑุงุจุญุฉ
  - `losing_trades`: ุนุฏุฏ ุงูุตููุงุช ุงูุฎุงุณุฑุฉ
  - `total_volume`: ุญุฌู ุงูุชุฏุงูู ุงูุฅุฌูุงูู
  - `spot_balance`: ุฑุตูุฏ Spot
  - `futures_balance`: ุฑุตูุฏ Futures

#### ๐ง ุงูุฏูุงู ุงูุฌุฏูุฏุฉ:
```python
save_portfolio_snapshot(user_id, account_type, snapshot_data)  # ุญูุธ ููุทุฉ ููููุฉ
get_portfolio_evolution(user_id, account_type, days)           # ุฌูุจ ุชุทูุฑ ุงููุญูุธุฉ
get_portfolio_statistics(user_id, account_type, days)          # ุญุณุงุจ ุฅุญุตุงุฆูุงุช ูุชูุฏูุฉ
```

#### ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุญุณูุจุฉ:
- ุงูุนุงุฆุฏ ุงูุฅุฌูุงูู (Total Return)
- ุฃุนูู/ุฃุฏูู ุฑุตูุฏ (Max/Min Balance)
- ุฃูุตู ุงูุฎูุงุถ (Max Drawdown)
- ูุชูุณุท ุงูุนุงุฆุฏ ุงููููู (Average Daily Return)
- ุงูุชููุจ (Volatility)
- ูุณุจุฉ ุดุงุฑุจ (Sharpe Ratio)
- ูุนุฏู ุงูููุฒ (Win Rate)
- ุนุฏุฏ ุงูุฃูุงู ุงูุฑุงุจุญุฉ/ุงูุฎุงุณุฑุฉ

---

### 2. ูุธุงู ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏู
**ุงูููู ุงูุฌุฏูุฏ:** `systems/advanced_statistics.py`

#### ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

##### ุฃ) ุฑุณู ุจูุงูู ูุตู ASCII
```python
generate_ascii_chart(data_points, width, height)
```
- ูุนุฑุถ ุชุทูุฑ ุงูุฑุตูุฏ ุจุดูู ูุฑุฆู
- ูุธูุฑ ุงูุงุชุฌุงู ุงูุตุงุนุฏ/ุงููุงุจุท
- ูุนุฑุถ ุฃุนูู/ุฃุฏูู ูููุฉ

##### ุจ) ุฅุญุตุงุฆูุงุช ุงูุตููุงุช ุงููุชูุฏูุฉ
```python
calculate_trade_statistics(user_id, account_type, days)
```

**ูุญุณุจ:**
- ุฅุฌูุงูู ุงูุตููุงุช ูุชุตููููุง (ุฑุงุจุญุฉ/ุฎุงุณุฑุฉ/ุชุนุงุฏู)
- ุฃูุถู ูุฃุณูุฃ ุตููุฉ
- ูุชูุณุท ุงูุฑุจุญ ูุงูุฎุณุงุฑุฉ
- ุนุงูู ุงูุฑุจุญ (Profit Factor)
- ูุชูุณุท ูุฏุฉ ุงูุตููุฉ
- ุชูุฒูุน ุงูุตููุงุช (Spot/Futures)
- ุฅุญุตุงุฆูุงุช ุญุณุจ ุงูุฑูุฒ (Symbol)
- ุฃูุถู 5 ุฑููุฒ ุฑุจุญูุฉ

##### ุฌ) ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุดุงููุฉ
```python
format_statistics_message(user_id, account_type, days)
```

**ูุนุฑุถ:**
```
๐ ADVANCED STATISTICS (30 ููู)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ ุฃุฏุงุก ุงููุญูุธุฉ:
โข ุงูุนุงุฆุฏ ุงูุฅุฌูุงูู: +1,234.56 USDT (+12.35%)
โข ุฃุนูู ุฑุตูุฏ: 11,234.56 USDT
โข ุฃุฏูู ุฑุตูุฏ: 9,876.54 USDT
โข Max Drawdown: 5.43%

๐ ููุงููุณ ุงูุฃุฏุงุก:
โข ูุชูุณุท ุงูุนุงุฆุฏ ุงููููู: +0.41%
โข ุงูุชููุจ (Volatility): 2.15%
โข Sharpe Ratio: 1.92
โข ุฃูุงู ุฑุงุจุญุฉ: 18 | ุฎุงุณุฑุฉ: 12

๐ผ ุฅุญุตุงุฆูุงุช ุงูุตููุงุช:
โข ุฅุฌูุงูู ุงูุตููุงุช: 45
โข ูุนุฏู ุงูููุฒ: 62.2% (28W / 17L)
โข ุฅุฌูุงูู P&L: +1,234.56 USDT ๐ข
โข ุญุฌู ุงูุชุฏุงูู: 45,678.90 USDT

๐ฐ ุชุญููู ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ:
โข ูุชูุณุท ุงูุฑุจุญ: +65.32 USDT
โข ูุชูุณุท ุงูุฎุณุงุฑุฉ: -38.45 USDT
โข Profit Factor: 1.70

๐ ุฃูุถู/ุฃุณูุฃ ุตููุฉ:
โข ุฃูุถู: BTCUSDT (+234.56 USDT)
โข ุฃุณูุฃ: ETHUSDT (-123.45 USDT)

๐ ุชูุฒูุน ุงูุตููุงุช:
โข Spot: 20 | Futures: 25
โข ูุชูุณุท ุงููุฏุฉ: 4.5 ุณุงุนุฉ

๐ ุฃูุถู 5 ุฑููุฒ:
๐ข BTCUSDT: +456.78 USDT (70%)
๐ข ETHUSDT: +234.56 USDT (65%)
๐ข BNBUSDT: +123.45 USDT (60%)
๐ด ADAUSDT: -45.67 USDT (45%)
๐ด DOGEUSDT: -23.45 USDT (40%)
```

##### ุฏ) ุชุทูุฑ ุงููุญูุธุฉ ูุน ุฑุณู ุจูุงูู
```python
format_portfolio_evolution_message(user_id, account_type, days)
```

**ูุนุฑุถ:**
```
๐ PORTFOLIO EVOLUTION (30 ููู)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Max: 11,234.56
โโฑโฑโโฒโฑโฑโโโฑโฑโฑโฑโโฒโฒโโโฑโฑโฑ
๐ Min: 9,876.54

๐ฐ ุงูุฑุตูุฏ:
โข ุงูุจุฏุงูุฉ: 10,000.00 USDT
โข ุงูุญุงูู: 11,234.56 USDT
โข ุงูุชุบูุฑ: +1,234.56 USDT (+12.35%) ๐ข

๐ ุงูุงุชุฌุงู: ุตุงุนุฏ

๐ ุงููุชุฑุฉ:
โข ูู: 2025-01-01
โข ุฅูู: 2025-01-30
โข ุนุฏุฏ ุงูุฃูุงู: 30

๐ ุขุฎุฑ 5 ุฃูุงู:
โข 2025-01-26: 11,100.23 USDT
โข 2025-01-27: 11,150.45 USDT
โข 2025-01-28: 11,200.67 USDT
โข 2025-01-29: 11,180.89 USDT
โข 2025-01-30: 11,234.56 USDT
```

##### ูู) ุญูุธ ุงูููุทุงุช ุงูููููุฉ ุชููุงุฆูุงู
```python
save_daily_snapshot(user_id, account_type)
```
- ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุฃู ุงููุญูุธุฉ
- ุชุญูุธ ุงูุจูุงูุงุช ูุฑุฉ ูุงุญุฏุฉ ููููุงู
- ุชุชุถูู ุฌููุน ุงูููุงููุณ ุงููููุฉ

---

### 3. ุชุญุณูู ุณุฌู ุงูุตููุงุช
**ุงูููู:** `systems/trade_history_display.py`

#### ๐ ุงูููุงุชุฑ ุงููุชูุฏูุฉ:

##### ุฃ) ููุชุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ
- ๐ 7 ุฃูุงู
- ๐ 30 ููู
- ๐ 90 ููู
- ๐ ุงููู

##### ุจ) ููุชุฑ ุงูุญุงูุฉ
- ๐ All (ุงููู)
- ๐ Open (ููุชูุญุฉ)
- โ Closed (ูุบููุฉ)

##### ุฌ) ููุชุฑ ููุน ุงูุญุณุงุจ
- ๐ผ Real (ุญูููู)
- ๐ฎ Demo (ุชุฌุฑูุจู)
- ๐ Both (ููุงููุง)

##### ุฏ) ููุชุฑ ููุน ุงูุณูู
- ๐ฑ Spot
- โก Futures
- ๐ Both (ููุงููุง)

##### ูู) ููุชุฑ ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ
- ๐ข ุฑุงุจุญุฉ
- ๐ด ุฎุงุณุฑุฉ
- ๐ ุงููู

#### ๐ฏ ุฃุฒุฑุงุฑ ุฅุถุงููุฉ:
- ๐ ุฃูุถู ุงูุตููุงุช
- ๐ ุฃุณูุฃ ุงูุตููุงุช
- ๐ ุชูุฑูุฑ ููุตู
- ๐ ุชุญุฏูุซ

---

### 4. ุงูุชูุงูู ูุน ุงูุจูุช
**ุงูููู:** `bybit_trading_bot.py`

#### ๐ ุงูุฃูุงูุฑ ุงูุฌุฏูุฏุฉ:

##### 1. `/statistics` - ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ
```python
async def statistics_command(update, context)
```
- ูุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุดุงููุฉ
- ูุญูุธ ููุทุฉ ููููุฉ ุชููุงุฆูุงู
- ูุฏุนู ุงูุชุจุฏูู ุจูู ุงููุชุฑุงุช ุงูุฒูููุฉ

##### 2. `/portfolio` - ุชุทูุฑ ุงููุญูุธุฉ (ูุญุณูู)
```python
async def portfolio_command(update, context)
```
- ูุนุฑุถ ุชุทูุฑ ุงููุญูุธุฉ ูุน ุฑุณู ุจูุงูู
- ูุญูุธ ููุทุฉ ููููุฉ ุชููุงุฆูุงู
- ูุฏุนู ุนุฑุถ ูุชุฑุงุช ูุฎุชููุฉ (7ุ 30ุ 90ุ 365 ููู)

#### ๐ ูุนุงูุฌุงุช Callback ุงูุฌุฏูุฏุฉ:

##### ุฃ) ูุนุงูุฌ ุงูุฅุญุตุงุฆูุงุช
```python
if data.startswith("stats_"):
    # stats_demo_30 โ ุฅุญุตุงุฆูุงุช ุงูุญุณุงุจ ุงูุชุฌุฑูุจู ูุขุฎุฑ 30 ููู
    # stats_real_7 โ ุฅุญุตุงุฆูุงุช ุงูุญุณุงุจ ุงูุญูููู ูุขุฎุฑ 7 ุฃูุงู
```

##### ุจ) ูุนุงูุฌ ุชุทูุฑ ุงููุญูุธุฉ
```python
if data.startswith("portfolio_evolution_"):
    # portfolio_evolution_demo_30 โ ุชุทูุฑ ุงููุญูุธุฉ ุงูุชุฌุฑูุจูุฉ ูุขุฎุฑ 30 ููู
    # portfolio_evolution_real_90 โ ุชุทูุฑ ุงููุญูุธุฉ ุงูุญููููุฉ ูุขุฎุฑ 90 ููู
```

#### ๐ก๏ธ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- ูุนุงูุฌุฉ ุฎุทุฃ "Message is not modified" ุนูุฏ ุงูุถุบุท ุนูู ููุณ ุงูุฒุฑ
- ุนุฑุถ ุฑุณุงูุฉ "๐ ุชู ุงูุชุญุฏูุซ" ุจุฏูุงู ูู ุงูุฎุทุฃ
- Fallback ูููุธุงู ุงููุฏูู ุฅุฐุง ูุดู ุงููุธุงู ุงูุฌุฏูุฏ

#### ๐จ ุชุญุฏูุซ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ:
- ุฒุฑ "๐ฐ ุงููุญูุธุฉ" โ ูุณุชุฏุนู `portfolio_command` ุงูุฌุฏูุฏ
- ุฒุฑ "๐ ุฅุญุตุงุฆูุงุช" โ ูุณุชุฏุนู `statistics_command` ุงูุฌุฏูุฏ

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุนุฑุถ ุชุทูุฑ ุงููุญูุธุฉ:
```
/portfolio
```
ุฃู ุงุถุบุท ุนูู ุฒุฑ "๐ฐ ุงููุญูุธุฉ" ูู ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

**ุงูุฃุฒุฑุงุฑ ุงููุชุงุญุฉ:**
- ๐ 7 ุฃูุงู / 30 ููู / 90 ููู / 365 ููู
- ๐ ุงูุฅุญุตุงุฆูุงุช (ููุงูุชูุงู ููุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ)
- ๐ ุชุญุฏูุซ
- ๐ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

### 2. ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงููุชูุฏูุฉ:
```
/statistics
```
ุฃู ุงุถุบุท ุนูู ุฒุฑ "๐ ุฅุญุตุงุฆูุงุช" ูู ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

**ุงูุฃุฒุฑุงุฑ ุงููุชุงุญุฉ:**
- ๐ 7 ุฃูุงู / 30 ููู / 90 ููู
- ๐ ุชุทูุฑ ุงููุญูุธุฉ (ููุงูุชูุงู ูุชุทูุฑ ุงููุญูุธุฉ)
- ๐ ุชุญุฏูุซ
- ๐ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

### 3. ุณุฌู ุงูุตููุงุช ุงููุญุณูู:
```
/history
```
ุฃู ุงุถุบุท ุนูู ุฒุฑ "๐ ุชุงุฑูุฎ ุงูุชุฏุงูู" ูู ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ

**ุงูููุงุชุฑ ุงููุชุงุญุฉ:**
- ุงููุชุฑุฉ ุงูุฒูููุฉ (7ุฏุ 30ุฏุ 90ุฏุ ุงููู)
- ุงูุญุงูุฉ (Allุ Openุ Closed)
- ููุน ุงูุญุณุงุจ (Realุ Demoุ Both)
- ููุน ุงูุณูู (Spotุ Futuresุ Both)
- ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ (ุฑุงุจุญุฉุ ุฎุงุณุฑุฉุ ุงููู)

**ุงูุฃุฒุฑุงุฑ ุงูุฅุถุงููุฉ:**
- ๐ ุฃูุถู ุงูุตููุงุช
- ๐ ุฃุณูุฃ ุงูุตููุงุช
- ๐ ุชูุฑูุฑ ููุตู
- ๐ ุชุญุฏูุซ

---

## ๐ ุงูุญูุธ ุงูุชููุงุฆู

### ุงูููุทุงุช ุงูููููุฉ:
- ูุชู ุญูุธ ููุทุฉ ููููุฉ ุชููุงุฆูุงู ุนูุฏ:
  - ุงุณุชุฏุนุงุก `/portfolio`
  - ุงุณุชุฏุนุงุก `/statistics`
  - ุงูุถุบุท ุนูู ุฒุฑ "ุชุญุฏูุซ"

### ุงูุจูุงูุงุช ุงููุญููุธุฉ:
- ุงูุฑุตูุฏ ุงูุญุงูู
- ุฅุฌูุงูู ุงูุฑุจุญ/ุงูุฎุณุงุฑุฉ
- ุนุฏุฏ ุงูุตููุงุช ุงูููุชูุญุฉ/ุงููุบููุฉ
- ุนุฏุฏ ุงูุตููุงุช ุงูุฑุงุจุญุฉ/ุงูุฎุงุณุฑุฉ
- ุญุฌู ุงูุชุฏุงูู ุงูุฅุฌูุงูู
- ุฑุตูุฏ Spot/Futures

---

## ๐ ุงูููุงููุณ ุงููุชูุฏูุฉ

### 1. Max Drawdown (ุฃูุตู ุงูุฎูุงุถ):
- ูููุณ ุฃูุจุฑ ุงูุฎูุงุถ ูู ุงูููุฉ ุฅูู ุงููุงุน
- ูุคุดุฑ ููู ูุชูููู ุงููุฎุงุทุฑ
- ูููุง ูุงู ุฃููุ ูุงู ุฃูุถู

### 2. Sharpe Ratio (ูุณุจุฉ ุดุงุฑุจ):
- ูููุณ ุงูุนุงุฆุฏ ุงููุนุฏู ุจุงููุฎุงุทุฑ
- ุฃูุจุฑ ูู 1 = ุฌูุฏ
- ุฃูุจุฑ ูู 2 = ููุชุงุฒ
- ุฃูุจุฑ ูู 3 = ุงุณุชุซูุงุฆู

### 3. Profit Factor (ุนุงูู ุงูุฑุจุญ):
- ูุณุจุฉ ุฅุฌูุงูู ุงูุฃุฑุจุงุญ ุฅูู ุฅุฌูุงูู ุงูุฎุณุงุฆุฑ
- ุฃูุจุฑ ูู 1 = ูุฑุจุญ
- ุฃูุจุฑ ูู 1.5 = ุฌูุฏ
- ุฃูุจุฑ ูู 2 = ููุชุงุฒ

### 4. Volatility (ุงูุชููุจ):
- ูููุณ ูุฏู ุชููุจ ุงูุนูุงุฆุฏ
- ูููุง ูุงู ุฃููุ ูุงู ุงูุฃุฏุงุก ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู

---

## ๐ ุงูุชุฑุงุจุท ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช

### โ ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
1. **ุงูููุทุงุช ุงูููููุฉ** โ `portfolio_snapshots`
2. **ุงูุตููุงุช** โ `orders`
3. **ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู** โ `user_settings`
4. **ุจูุงูุงุช ุงููุณุชุฎุฏู** โ `users`

### ๐ ุงูุชุญุฏูุซ ุงูุชููุงุฆู:
- ูุชู ุญูุธ ููุทุฉ ููููุฉ ูุงุญุฏุฉ ููุท (INSERT OR REPLACE)
- ูุง ููุฌุฏ ุชูุฑุงุฑ ููุจูุงูุงุช
- ุงูุจูุงูุงุช ุฏุงุฆูุฉ ููุง ุชูููุฏ ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู

### ๐๏ธ ุฅุนุงุฏุฉ ุงูุชุนููู:
- ุนูุฏ ุงุณุชุฎุฏุงู "ุฅุนุงุฏุฉ ุชุนููู ูู ุงููุดุฑูุน"
- ูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุจูุง ูููุง ุงูููุทุงุช ุงูููููุฉ
- ูุชู ุฅุนุงุฏุฉ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุตูุฑ

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุญุตุงุฆูุงุช ููุญูุธุฉ ูุชูุฏู ูุดูู:

โ **ูุงุนุฏุฉ ุจูุงูุงุช ูุญุณููุฉ** ูุน ุฌุฏูู ูููุทุงุช ุงูููููุฉ
โ **ุฅุญุตุงุฆูุงุช ูุชูุฏูุฉ** ูุน ููุงููุณ ุงุญุชุฑุงููุฉ (Sharpe Ratioุ Max Drawdownุ Profit Factor)
โ **ุฑุณูู ุจูุงููุฉ ูุตูุฉ** ูุชุทูุฑ ุงููุญูุธุฉ
โ **ููุงุชุฑ ูุชูุฏูุฉ** ูุณุฌู ุงูุตููุงุช
โ **ุชูุงูู ูุงูู** ูุน ุงูุจูุช
โ **ุญูุธ ุชููุงุฆู** ููุจูุงูุงุช
โ **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณููุฉ**
โ **ูุงุฌูุฉ ุงุญุชุฑุงููุฉ** ุดุจููุฉ ุจููุตุงุช ุงูุชุฏุงูู

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูููุทุงุช ุงูููููุฉ** ุชูุญูุธ ุชููุงุฆูุงู ููุง ุชุญุชุงุฌ ุชุฏุฎู ูุฏูู
2. **ุงูุจูุงูุงุช ุฏุงุฆูุฉ** ููุง ุชูููุฏ ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
3. **ุงูุฅุญุตุงุฆูุงุช ุฏูููุฉ** ููุญุณูุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. **ุงูุฑุณูู ุงูุจูุงููุฉ** ุชููุดุฃ ุฏููุงููููุงู ูู ุงูุจูุงูุงุช ุงูุญููููุฉ
5. **ุงูููุงุชุฑ** ุชุนูู ูุจุงุดุฑุฉ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุณุฑูุนุฉ ููุนุงูุฉ)

---

**๐ฏ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุงููุงูู!**

